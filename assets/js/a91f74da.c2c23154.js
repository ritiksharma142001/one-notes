"use strict";(globalThis.webpackChunkes_note=globalThis.webpackChunkes_note||[]).push([[7912],{28453(e,n,i){i.d(n,{R:()=>r,x:()=>s});var t=i(96540);const l={},a=t.createContext(l);function r(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),t.createElement(a.Provider,{value:n},e.children)}},69409(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"advanced-java/0-1/Week-3/3.5","title":"Mapping-1","description":"Relationships in Spring Data JPA","source":"@site/docs/advanced-java/0-1/Week-3/3.5.md","sourceDirName":"advanced-java/0-1/Week-3","slug":"/advanced-java/0-1/Week-3/3.5","permalink":"/one-notes/advanced-java/0-1/Week-3/3.5","draft":false,"unlisted":false,"editUrl":"https://github.com/ritiksharma142001/one-notes/edit/main/docs/advanced-java/0-1/Week-3/3.5.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Sorting & Pagination","permalink":"/one-notes/advanced-java/0-1/Week-3/3.4"},"next":{"title":"Mapping-2","permalink":"/one-notes/advanced-java/0-1/Week-3/3.6"}}');var l=i(74848),a=i(28453);const r={sidebar_position:5},s="Mapping-1",d={},o=[{value:"Relationships in Spring Data JPA",id:"relationships-in-spring-data-jpa",level:2},{value:"Introduction to Relationships in Databases",id:"introduction-to-relationships-in-databases",level:3},{value:"Entity Relationship Example: Department, Employee, and Project",id:"entity-relationship-example-department-employee-and-project",level:3},{value:"Relationship Types in JPA",id:"relationship-types-in-jpa",level:3},{value:"Bidirectional vs. Unidirectional Mapping",id:"bidirectional-vs-unidirectional-mapping",level:3},{value:"SQL vs JPA Mapping",id:"sql-vs-jpa-mapping",level:3},{value:"Focus of This Course",id:"focus-of-this-course",level:3},{value:"Clarification on Entities vs Tables",id:"clarification-on-entities-vs-tables",level:3},{value:"Overview of the Project Structure",id:"overview-of-the-project-structure",level:2},{value:"Current Setup in the Project",id:"current-setup-in-the-project",level:3},{value:"Application Configuration",id:"application-configuration",level:3},{value:"Goal of This Session: One-to-One Mapping",id:"goal-of-this-session-one-to-one-mapping",level:3},{value:"Key JPA Mapping Concepts",id:"key-jpa-mapping-concepts",level:3},{value:"Database Auto-Creation and Setup",id:"database-auto-creation-and-setup",level:3},{value:"Tables Created Automatically",id:"tables-created-automatically",level:3},{value:"Avoiding Extra Sequence Tables in MySQL",id:"avoiding-extra-sequence-tables-in-mysql",level:3},{value:"Current State of Tables",id:"current-state-of-tables",level:3},{value:"Key Concepts Before Defining Mappings",id:"key-concepts-before-defining-mappings",level:3},{value:"Defining One-to-One Mapping Between Department and Manager (Employee)",id:"defining-one-to-one-mapping-between-department-and-manager-employee",level:2},{value:"Deciding Ownership of the Relationship",id:"deciding-ownership-of-the-relationship",level:3},{value:"Creating the One-to-One Relationship",id:"creating-the-one-to-one-relationship",level:3},{value:"Customizing the One-to-One Mapping",id:"customizing-the-one-to-one-mapping",level:3},{value:"Running and Inspecting Database",id:"running-and-inspecting-database",level:3},{value:"Understanding the Unique Constraint",id:"understanding-the-unique-constraint",level:3},{value:"Customizing Column Name Using <code>@JoinColumn</code>",id:"customizing-column-name-using-joincolumn",level:3},{value:"Final Table Structure",id:"final-table-structure",level:3},{value:"Current Mapping Direction",id:"current-mapping-direction",level:3},{value:"Implementing Bidirectional One-to-One Mapping",id:"implementing-bidirectional-one-to-one-mapping",level:2},{value:"Enabling Two-Way (Bidirectional) Mapping",id:"enabling-two-way-bidirectional-mapping",level:3},{value:"Step 1: Define Mapping in <code>Employee</code> Entity",id:"step-1-define-mapping-in-employee-entity",level:3},{value:"Why Use <code>mappedBy</code>?",id:"why-use-mappedby",level:3},{value:"Result in Database Schema",id:"result-in-database-schema",level:3},{value:"Verifying Employee Table",id:"verifying-employee-table",level:3},{value:"Practical Behavior",id:"practical-behavior",level:3},{value:"Hibernate Responsibility",id:"hibernate-responsibility",level:3},{value:"Assign Manager to Department",id:"assign-manager-to-department",level:2},{value:"Controller Setup",id:"controller-setup",level:3},{value:"Define PUT Mapping in Controller",id:"define-put-mapping-in-controller",level:3},{value:"Implement Service Method",id:"implement-service-method",level:3},{value:"Dependency Injection",id:"dependency-injection",level:3},{value:"Why Optional and flatMap?",id:"why-optional-and-flatmap",level:3},{value:"Testing with Postman",id:"testing-with-postman",level:3},{value:"393",id:"393",level:2},{value:"Recursive Issue in Bidirectional One-to-One Mapping &amp; Solutions Using Jackson",id:"recursive-issue-in-bidirectional-one-to-one-mapping--solutions-using-jackson",level:2},{value:"Problem Identification",id:"problem-identification",level:3},{value:"Cause",id:"cause",level:3},{value:"Solution",id:"solution",level:3},{value:"Post-Solution Behavior",id:"post-solution-behavior",level:3},{value:"Creating a New API to Fetch Department Managed by a Manager",id:"creating-a-new-api-to-fetch-department-managed-by-a-manager",level:2},{value:"New Endpoint Design",id:"new-endpoint-design",level:3},{value:"Controller Method",id:"controller-method",level:3},{value:"Service Method (Approach 1 \u2013 Via Employee)",id:"service-method-approach-1--via-employee",level:3},{value:"code",id:"code",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"mapping-1",children:"Mapping-1"})}),"\n",(0,l.jsx)(n.h2,{id:"relationships-in-spring-data-jpa",children:"Relationships in Spring Data JPA"}),"\n",(0,l.jsx)(n.h3,{id:"introduction-to-relationships-in-databases",children:"Introduction to Relationships in Databases"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["In real-world systems like a college database:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"A college can have multiple classrooms."}),"\n",(0,l.jsx)(n.li,{children:"A professor can teach multiple students."}),"\n",(0,l.jsx)(n.li,{children:"A student can enroll in multiple courses, and a course can have multiple students."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"These examples demonstrate relationships between entities."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"entity-relationship-example-department-employee-and-project",children:"Entity Relationship Example: Department, Employee, and Project"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Entities: ",(0,l.jsx)(n.code,{children:"Department"}),", ",(0,l.jsx)(n.code,{children:"Employee"}),", ",(0,l.jsx)(n.code,{children:"Project"})]}),"\n",(0,l.jsxs)(n.li,{children:["Relationships:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["One-to-One:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["A ",(0,l.jsx)(n.code,{children:"Department"})," can have one manager, who is an ",(0,l.jsx)(n.code,{children:"Employee"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["One-to-Many / Many-to-One:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["A ",(0,l.jsx)(n.code,{children:"Department"})," can have many workers (Employees)."]}),"\n",(0,l.jsxs)(n.li,{children:["Each ",(0,l.jsx)(n.code,{children:"Employee"})," works in one department."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Many-to-Many:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["An ",(0,l.jsx)(n.code,{children:"Employee"})," can work on multiple projects."]}),"\n",(0,l.jsxs)(n.li,{children:["A ",(0,l.jsx)(n.code,{children:"Project"})," can have multiple employees working on it."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"relationship-types-in-jpa",children:"Relationship Types in JPA"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"@OneToOne \u2013 One entity has exactly one related entity."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"@OneToMany \u2013 One entity is related to many others."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"@ManyToOne \u2013 Many entities are related to one."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"@ManyToMany \u2013 Many entities are related to many others."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Example:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Department"})," \u2194 ",(0,l.jsx)(n.code,{children:"Manager"})," \u2192 ",(0,l.jsx)(n.code,{children:"@OneToOne"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Department"})," \u2194 ",(0,l.jsx)(n.code,{children:"Employees"})," \u2192 ",(0,l.jsx)(n.code,{children:"@OneToMany"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Employee"})," \u2194 ",(0,l.jsx)(n.code,{children:"Department"})," \u2192 ",(0,l.jsx)(n.code,{children:"@ManyToOne"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Employee"})," \u2194 ",(0,l.jsx)(n.code,{children:"Project"})," \u2192 ",(0,l.jsx)(n.code,{children:"@ManyToMany"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"bidirectional-vs-unidirectional-mapping",children:"Bidirectional vs. Unidirectional Mapping"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["JPA allows relationships to be mapped in both directions:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Example: From Employee to Department and vice versa."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Relationships can be:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Unidirectional \u2013 Only one side knows about the other."}),"\n",(0,l.jsx)(n.li,{children:"Bidirectional \u2013 Both sides reference each other using mapped entities."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"sql-vs-jpa-mapping",children:"SQL vs JPA Mapping"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"In SQL:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Relationships are handled using foreign keys and constraints."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"In Spring Data JPA:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Relationships are mapped using annotations (@OneToOne, @ManyToOne, etc.)."}),"\n",(0,l.jsx)(n.li,{children:"SQL schema is generated automatically by Hibernate."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Hibernate handles table creation, foreign keys, and join tables internally."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"focus-of-this-course",children:"Focus of This Course"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"The course emphasizes Spring Data JPA, not raw SQL."}),"\n",(0,l.jsx)(n.li,{children:"Though SQL knowledge is helpful, it's not mandatory."}),"\n",(0,l.jsx)(n.li,{children:"Entity mapping and relationship creation will be demonstrated using JPA annotations, not manual SQL."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"clarification-on-entities-vs-tables",children:"Clarification on Entities vs Tables"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"The focus is on Java Entities, not direct SQL tables."}),"\n",(0,l.jsx)(n.li,{children:"While SQL has tables, in JPA we model entities, and Hibernate manages table creation automatically."}),"\n",(0,l.jsxs)(n.li,{children:["Example: An ",(0,l.jsx)(n.code,{children:"Employee"})," entity in Java corresponds to an ",(0,l.jsx)(n.code,{children:"employee"})," table in SQL, created by Hibernate."]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"overview-of-the-project-structure",children:"Overview of the Project Structure"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"We are creating a project that demonstrates JPA mappings."}),"\n",(0,l.jsxs)(n.li,{children:["The project will include three entities:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Department"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Employee"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Project"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Currently, only the Department and Employee entities are created.\nThe Project entity will be added in a future lecture."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"current-setup-in-the-project",children:"Current Setup in the Project"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Entities"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Both ",(0,l.jsx)(n.code,{children:"Department"})," and ",(0,l.jsx)(n.code,{children:"Employee"})," entities have been created."]}),"\n",(0,l.jsx)(n.li,{children:"No mapping annotations have been added yet."}),"\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"Department"})," entity contains:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"id"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"title"})}),"\n",(0,l.jsx)(n.li,{children:"It does not yet have a manager field."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"Employee"})," entity contains:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"id"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"name"})}),"\n",(0,l.jsx)(n.li,{children:"No relationships defined yet."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Repositories"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Basic Spring Data JPA repositories have been defined:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"DepartmentRepository"})," and ",(0,l.jsx)(n.code,{children:"EmployeeRepository"})," extend ",(0,l.jsx)(n.code,{children:"JpaRepository"}),"."]}),"\n",(0,l.jsx)(n.li,{children:"No custom methods are added yet."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Services"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Two service methods are implemented for each entity:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["DepartmentService:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"getDepartmentById"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"createDepartment"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["EmployeeService:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"getEmployeeById"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"createEmployee"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["These methods use the ",(0,l.jsx)(n.code,{children:"save"})," and ",(0,l.jsx)(n.code,{children:"findById"})," operations provided by Spring Data JPA."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Controllers"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Basic REST endpoints are created:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["For ",(0,l.jsx)(n.code,{children:"Department"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"GET /department/{id}"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"POST /department"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Note: The application directly uses entity classes in the controller, which is not a best practice.","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"DTOs (Data Transfer Objects) should be used instead."}),"\n",(0,l.jsx)(n.li,{children:"However, this is skipped here to focus only on learning JPA mappings."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"application-configuration",children:"Application Configuration"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"The application connects to a MySQL database."}),"\n",(0,l.jsxs)(n.li,{children:["A new database named ",(0,l.jsx)(n.code,{children:"mappings"})," has been created for this project."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"application.properties"})," includes standard configuration for:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"JDBC URL"}),"\n",(0,l.jsx)(n.li,{children:"Username/password"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"pom.xml"})," includes only necessary dependencies:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"spring-boot-starter-data-jpa"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"spring-boot-starter-web"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"mysql-connector-java"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"lombok"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"goal-of-this-session-one-to-one-mapping",children:"Goal of This Session: One-to-One Mapping"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["We aim to demonstrate One-to-One Mapping between ",(0,l.jsx)(n.code,{children:"Department"})," and ",(0,l.jsx)(n.code,{children:"Employee"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Each Department has one Manager."}),"\n",(0,l.jsx)(n.li,{children:"One Employee can be a Manager for at most one Department."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Additional details:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Every Department must have a Manager."}),"\n",(0,l.jsx)(n.li,{children:"Not all Employees are Managers."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"key-jpa-mapping-concepts",children:"Key JPA Mapping Concepts"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"1. @Entity"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["A class annotated with ",(0,l.jsx)(n.code,{children:"@Entity"})," represents a table in the database."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"2. @Id"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"@Id"})," annotation marks the primary key of the table."]}),"\n",(0,l.jsx)(n.li,{children:"It guarantees uniqueness \u2014 two records cannot have the same ID."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"3. Foreign Key"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"A foreign key is a field in one table that refers to the primary key of another table."}),"\n",(0,l.jsxs)(n.li,{children:["Example:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"department"})," table may have a ",(0,l.jsx)(n.code,{children:"manager_id"})," column."]}),"\n",(0,l.jsxs)(n.li,{children:["This ",(0,l.jsx)(n.code,{children:"manager_id"})," references the ",(0,l.jsx)(n.code,{children:"id"})," field of the ",(0,l.jsx)(n.code,{children:"employee"})," table."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"database-auto-creation-and-setup",children:"Database Auto-Creation and Setup"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["We are using ",(0,l.jsx)(n.code,{children:"spring.jpa.hibernate.ddl-auto=create"})," in ",(0,l.jsx)(n.code,{children:"application.properties"}),".","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"This setting drops the existing schema and recreates it on application startup."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["We created a new database named ",(0,l.jsx)(n.code,{children:"mappings"})," in MySQL."]}),"\n",(0,l.jsxs)(n.li,{children:["How to create a new database in tools like IntelliJ/Datagrip:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Right-click on ",(0,l.jsx)(n.code,{children:"Databases"})]}),"\n",(0,l.jsx)(n.li,{children:"Choose New > Database"}),"\n",(0,l.jsxs)(n.li,{children:["Enter database name (e.g., ",(0,l.jsx)(n.code,{children:"mappings"}),") and default options"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"tables-created-automatically",children:"Tables Created Automatically"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"After application startup, the following tables are created:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"departments"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"employees"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"department_sequence"})," (auto-generated)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"employee_sequence"})," (auto-generated)"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["The sequence tables are used to generate ID values using ",(0,l.jsx)(n.code,{children:"@GeneratedValue(strategy = GenerationType.SEQUENCE)"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"These sequence tables:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Only have a column like ",(0,l.jsx)(n.code,{children:"next_val"})," which stores the next ID value."]}),"\n",(0,l.jsx)(n.li,{children:"Are not always needed, especially in MySQL."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"avoiding-extra-sequence-tables-in-mysql",children:"Avoiding Extra Sequence Tables in MySQL"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The creation of sequence tables occurs when using ",(0,l.jsx)(n.code,{children:"@GeneratedValue(strategy = GenerationType.SEQUENCE)"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["To avoid this in MySQL (which does not support sequences natively):","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"@GeneratedValue(strategy = GenerationType.IDENTITY)"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"IDENTITY strategy allows MySQL to auto-increment the ID without extra tables."}),"\n",(0,l.jsx)(n.li,{children:"How to Fix:"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"@Id\n@GeneratedValue(strategy = GenerationType.IDENTITY)\nprivate Long id;\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["After changing to ",(0,l.jsx)(n.code,{children:"IDENTITY"}),", the sequence tables are no longer needed."]}),"\n",(0,l.jsx)(n.li,{children:"You can manually delete the old sequence tables if required."}),"\n",(0,l.jsx)(n.li,{children:"Never delete tables in production manually. Doing so can lead to data loss. Always use migrations or schema management tools."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"current-state-of-tables",children:"Current State of Tables"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["After cleanup and re-run:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Only two tables exist: ",(0,l.jsx)(n.code,{children:"departments"}),", ",(0,l.jsx)(n.code,{children:"employees"})]}),"\n",(0,l.jsxs)(n.li,{children:["Each table currently has only:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"id"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"title"})," or ",(0,l.jsx)(n.code,{children:"name"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"No foreign key or relationship defined yet."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"key-concepts-before-defining-mappings",children:"Key Concepts Before Defining Mappings"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"1. Foreign Key"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"A foreign key in one table points to a primary key in another table."}),"\n",(0,l.jsxs)(n.li,{children:["Example:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Department"})," has a ",(0,l.jsx)(n.code,{children:"manager_id"})," (foreign key)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Employee"})," has ",(0,l.jsx)(n.code,{children:"id"})," (primary key)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"2. Cascade Types"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Controls what happens to related entities when an operation is performed on the owning entity."}),"\n",(0,l.jsxs)(n.li,{children:["For example:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"If a Department is deleted, should its Manager (Employee) also be deleted?"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Common cascade types:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"CascadeType.ALL"}),", ",(0,l.jsx)(n.code,{children:"PERSIST"}),", ",(0,l.jsx)(n.code,{children:"MERGE"}),", ",(0,l.jsx)(n.code,{children:"REMOVE"}),", ",(0,l.jsx)(n.code,{children:"REFRESH"}),", ",(0,l.jsx)(n.code,{children:"DETACH"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"3. Fetch Types"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Controls when related data is fetched from the database.","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"FetchType.EAGER"}),": Loads related entity immediately."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"FetchType.LAZY"}),": Loads related entity only when accessed."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Example:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"When fetching a Department:"}),"\n",(0,l.jsx)(n.li,{children:"EAGER fetch: Manager is fetched too."}),"\n",(0,l.jsxs)(n.li,{children:["LAZY fetch: Manager is fetched only when ",(0,l.jsx)(n.code,{children:"getManager()"})," is called."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"defining-one-to-one-mapping-between-department-and-manager-employee",children:"Defining One-to-One Mapping Between Department and Manager (Employee)"}),"\n",(0,l.jsx)(n.h3,{id:"deciding-ownership-of-the-relationship",children:"Deciding Ownership of the Relationship"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Each Department has one Manager (an Employee)."}),"\n",(0,l.jsxs)(n.li,{children:["Decision: Where should we define the relationship?","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Option 1: Define ",(0,l.jsx)(n.code,{children:"department"})," in the ",(0,l.jsx)(n.code,{children:"Employee"})," entity."]}),"\n",(0,l.jsxs)(n.li,{children:["Option 2: Define ",(0,l.jsx)(n.code,{children:"employee"})," (manager) in the ",(0,l.jsx)(n.code,{children:"Department"})," entity."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 Chosen: Define the manager in the ",(0,l.jsx)(n.code,{children:"Department"})," entity.","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Reason: Not all employees are managers, so keeping a nullable ",(0,l.jsx)(n.code,{children:"department"})," field in ",(0,l.jsx)(n.code,{children:"Employee"})," is not meaningful."]}),"\n",(0,l.jsxs)(n.li,{children:["But every department must have a manager, hence it makes logical sense to give ownership of the mapping to the ",(0,l.jsx)(n.code,{children:"Department"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"creating-the-one-to-one-relationship",children:"Creating the One-to-One Relationship"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Inside the Department entity:"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"@OneToOne\nprivate Employee manager;\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"manager"})," is directly linked to the ",(0,l.jsx)(n.code,{children:"Employee"})," entity."]}),"\n",(0,l.jsxs)(n.li,{children:["Without any annotations, the system throws an error:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:'"Entity attribute is not marked with an association annotation"'}),"\n",(0,l.jsxs)(n.li,{children:["So, we annotate with ",(0,l.jsx)(n.code,{children:"@OneToOne"})," to indicate the relationship."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"customizing-the-one-to-one-mapping",children:"Customizing the One-to-One Mapping"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"@OneToOne"})," allows configuration:"]}),"\n",(0,l.jsx)(n.li,{children:"CascadeType: To propagate operations (e.g., persist, delete)."}),"\n",(0,l.jsxs)(n.li,{children:["FetchType:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"EAGER"})," (default): Loads manager immediately when department is fetched."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"LAZY"}),": Loads manager only when explicitly accessed."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"mappedBy: Used for bidirectional relationships (not applied yet here)."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"running-and-inspecting-database",children:"Running and Inspecting Database"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["After running the application:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["A foreign key column ",(0,l.jsx)(n.code,{children:"manager_id"})," is added to the ",(0,l.jsx)(n.code,{children:"departments"})," table."]}),"\n",(0,l.jsxs)(n.li,{children:["By default, the column name is inferred as ",(0,l.jsx)(n.code,{children:"manager_id"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["A unique constraint is automatically added:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Ensures one-to-one relationship (i.e., one manager cannot manage multiple departments)."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"understanding-the-unique-constraint",children:"Understanding the Unique Constraint"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The unique constraint on ",(0,l.jsx)(n.code,{children:"manager_id"})," ensures:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"One manager \u2192 One department"}),"\n",(0,l.jsx)(n.li,{children:"Prevents many-to-one behavior (i.e., multiple departments with same manager)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"customizing-column-name-using-joincolumn",children:["Customizing Column Name Using ",(0,l.jsx)(n.code,{children:"@JoinColumn"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"To rename the foreign key column:"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@OneToOne\n@JoinColumn(name = "department_manager")\nprivate Employee manager;\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Now, the column in ",(0,l.jsx)(n.code,{children:"departments"})," table will be named ",(0,l.jsx)(n.code,{children:"department_manager"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"final-table-structure",children:"Final Table Structure"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["After refresh, ",(0,l.jsx)(n.code,{children:"departments"})," table contains:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"id"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"title"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"department_manager"})," (foreign key to ",(0,l.jsx)(n.code,{children:"employees"})," table)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"current-mapping-direction",children:"Current Mapping Direction"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"The mapping is currently unidirectional:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Department knows who the manager is."}),"\n",(0,l.jsx)(n.li,{children:"But the Employee entity does not know which department they are managing."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\ud83d\udd0d Example:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Multiple employees exist, but none of them are aware that they are managing a department."}),"\n",(0,l.jsx)(n.li,{children:"Meanwhile, each department clearly knows its manager."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"implementing-bidirectional-one-to-one-mapping",children:"Implementing Bidirectional One-to-One Mapping"}),"\n",(0,l.jsx)(n.h3,{id:"enabling-two-way-bidirectional-mapping",children:"Enabling Two-Way (Bidirectional) Mapping"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["If you want both ",(0,l.jsx)(n.code,{children:"Department"})," and ",(0,l.jsx)(n.code,{children:"Employee"})," to know about their association, you can make the mapping bidirectional."]}),"\n",(0,l.jsxs)(n.li,{children:["This is useful when:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"You want to access the department managed by an employee."}),"\n",(0,l.jsx)(n.li,{children:"And the manager of a given department."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"step-1-define-mapping-in-employee-entity",children:["Step 1: Define Mapping in ",(0,l.jsx)(n.code,{children:"Employee"})," Entity"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["In the ",(0,l.jsx)(n.code,{children:"Employee"})," entity, define a field that points back to the ",(0,l.jsx)(n.code,{children:"Department"}),":"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@OneToOne(mappedBy = "manager")\nprivate Department managedDepartment;\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Here","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:'mappedBy = "manager"'})," refers to the field in the ",(0,l.jsx)(n.code,{children:"Department"})," entity."]}),"\n",(0,l.jsxs)(n.li,{children:["This tells Hibernate that the ",(0,l.jsx)(n.code,{children:"Department"})," entity owns the relationship."]}),"\n",(0,l.jsxs)(n.li,{children:["Hence, no additional foreign key column will be created in the ",(0,l.jsx)(n.code,{children:"Employee"})," table."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"why-use-mappedby",children:["Why Use ",(0,l.jsx)(n.code,{children:"mappedBy"}),"?"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Without ",(0,l.jsx)(n.code,{children:"mappedBy"}),", Hibernate will create a separate foreign key in the ",(0,l.jsx)(n.code,{children:"Employee"})," table."]}),"\n",(0,l.jsxs)(n.li,{children:["But since the relationship is already defined in the ",(0,l.jsx)(n.code,{children:"Department"})," entity, using ",(0,l.jsx)(n.code,{children:"mappedBy"})," avoids duplication."]}),"\n",(0,l.jsx)(n.li,{children:"This ensures only one side (Department) owns and maintains the mapping in the database schema."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"result-in-database-schema",children:"Result in Database Schema"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["After running the application:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"Employee"})," table remains unchanged."]}),"\n",(0,l.jsxs)(n.li,{children:["It does not get a new column or constraint for the ",(0,l.jsx)(n.code,{children:"Department"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["The foreign key still exists only in the ",(0,l.jsx)(n.code,{children:"Department"})," table (",(0,l.jsx)(n.code,{children:"manager_id"})," or renamed as ",(0,l.jsx)(n.code,{children:"department_manager"})," if ",(0,l.jsx)(n.code,{children:"@JoinColumn"})," is used)."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"This proves that bidirectional mapping is purely object-level, not schema-level on both sides."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"verifying-employee-table",children:"Verifying Employee Table"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Upon refreshing the database:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"Employee"})," table has no new foreign key related to departments."]}),"\n",(0,l.jsxs)(n.li,{children:["Only contains its primary key constraint on ",(0,l.jsx)(n.code,{children:"id"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"practical-behavior",children:"Practical Behavior"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Now you can do the following:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["From ",(0,l.jsx)(n.code,{children:"Department"}),", access the ",(0,l.jsx)(n.code,{children:"manager"})," (Employee)."]}),"\n",(0,l.jsxs)(n.li,{children:["From ",(0,l.jsx)(n.code,{children:"Employee"}),", access the ",(0,l.jsx)(n.code,{children:"managedDepartment"})," (Department)."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Hibernate handles the underlying SQL joins automatically."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"hibernate-responsibility",children:"Hibernate Responsibility"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["When accessing ",(0,l.jsx)(n.code,{children:"managedDepartment"})," from an ",(0,l.jsx)(n.code,{children:"Employee"})," object:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Hibernate will automatically generate the SQL query to fetch the related ",(0,l.jsx)(n.code,{children:"Department"}),"."]}),"\n",(0,l.jsx)(n.li,{children:"Developers do not need to write manual queries for this association."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"assign-manager-to-department",children:"Assign Manager to Department"}),"\n",(0,l.jsx)(n.h3,{id:"controller-setup",children:"Controller Setup"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"We already have endpoints to create a department and fetch a department by ID."}),"\n",(0,l.jsx)(n.li,{children:"Now, we\u2019ll add a PUT mapping to assign a manager (an employee) to a department."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"define-put-mapping-in-controller",children:"Define PUT Mapping in Controller"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@PutMapping("/departments/{departmentId}/manager/{employeeId}")\npublic Department assignManagerToDepartment(\n    @PathVariable Long departmentId,\n    @PathVariable Long employeeId\n) {\n    return departmentService.assignManagerToDepartment(departmentId, employeeId);\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"implement-service-method",children:"Implement Service Method"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Create a new method in the DepartmentService to handle assignment:"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"public Department assignManagerToDepartment(Long deptId, Long empId) {\n    Optional<Department> optionalDept = departmentRepository.findById(deptId);\n    Optional<Employee> optionalEmp = employeeRepository.findById(empId);\n\n    return optionalDept.flatMap(dept ->\n        optionalEmp.map(emp -> {\n            dept.setManager(emp);\n            return departmentRepository.save(dept);\n        })\n    ).orElse(null); // Can be replaced with proper exception handling\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"dependency-injection",children:"Dependency Injection"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Inject both ",(0,l.jsx)(n.code,{children:"DepartmentRepository"})," and ",(0,l.jsx)(n.code,{children:"EmployeeRepository"})," in the service class."]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"@Autowired\nprivate DepartmentRepository departmentRepository;\n\n@Autowired\nprivate EmployeeRepository employeeRepository;\n"})}),"\n",(0,l.jsx)(n.h3,{id:"why-optional-and-flatmap",children:"Why Optional and flatMap?"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Avoids multiple ",(0,l.jsx)(n.code,{children:"if-else"})," checks."]}),"\n",(0,l.jsx)(n.li,{children:"Ensures both Department and Employee exist before assignment."}),"\n",(0,l.jsxs)(n.li,{children:["Clean functional style using ",(0,l.jsx)(n.code,{children:"Optional.map()"})," and ",(0,l.jsx)(n.code,{children:"flatMap()"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"testing-with-postman",children:"Testing with Postman"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Step 1: Create Department"}),"\n",(0,l.jsx)(n.li,{children:"POST /departments"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "title": "HR"\n}\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Response: Department created with manager as null."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Step 2: Create Employee"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"POST /employees"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "Anuj"\n}\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Response: Employee created with ID."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Step 3: Assign Manager to Department"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"PUT /departments/1/manager/1"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"This assigns Employee with ID 1 as manager to Department with ID 1."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Step 4: Confirm Assignment"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"GET /departments/1"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"You should now see the manager field populated with Employee details."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"When fetching Department, it automatically fetches associated Manager."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"This happens because the JPA relationship uses FetchType.EAGER."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"393",children:"393"}),"\n",(0,l.jsx)(n.h2,{id:"recursive-issue-in-bidirectional-one-to-one-mapping--solutions-using-jackson",children:"Recursive Issue in Bidirectional One-to-One Mapping & Solutions Using Jackson"}),"\n",(0,l.jsx)(n.h3,{id:"problem-identification",children:"Problem Identification"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["When fetching a Department by ID, the response includes:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Department \u2192 Manager (Employee)"}),"\n",(0,l.jsx)(n.li,{children:"Manager \u2192 Managed Department (same Department)"}),"\n",(0,l.jsx)(n.li,{children:"Which again includes Manager \u2192 Department \u2192 and so on..."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"This creates an infinite recursive loop during JSON serialization."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"cause",children:"Cause"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The bidirectional relationship between ",(0,l.jsx)(n.code,{children:"Department"})," and ",(0,l.jsx)(n.code,{children:"Employee"})," leads to recursive serialization."]}),"\n",(0,l.jsx)(n.li,{children:"This occurs due to Jackson (the JSON serialization library) trying to serialize both sides of the relationship."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"solution",children:"Solution"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"@JsonIgnore"})," on the back-reference field to prevent recursion."]}),"\n",(0,l.jsxs)(n.li,{children:["Add ",(0,l.jsx)(n.code,{children:"@JsonIgnore"})," on ",(0,l.jsx)(n.code,{children:"Employee.getManagedDepartment()"})," or the relevant field."]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@JsonIgnore\n@OneToOne(mappedBy = "manager")\nprivate Department managedDepartment;\n'})}),"\n",(0,l.jsx)(n.h3,{id:"post-solution-behavior",children:"Post-Solution Behavior"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Fetching Department by ID now:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Returns the ",(0,l.jsx)(n.code,{children:"manager"})," field correctly."]}),"\n",(0,l.jsxs)(n.li,{children:["Does not return ",(0,l.jsx)(n.code,{children:"managedDepartment"})," under the ",(0,l.jsx)(n.code,{children:"manager"})," object."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Fetching Employee by ID:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Returns basic employee info."}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"managedDepartment"})," is now excluded from JSON."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"creating-a-new-api-to-fetch-department-managed-by-a-manager",children:"Creating a New API to Fetch Department Managed by a Manager"}),"\n",(0,l.jsx)(n.h3,{id:"new-endpoint-design",children:"New Endpoint Design"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Goal: Fetch the department managed by a specific employee."}),"\n",(0,l.jsx)(n.li,{children:"Endpoint:"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"GET /departments/assigned-department-of-manager/{employeeId}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"controller-method",children:"Controller Method"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@GetMapping("/departments/assigned-department-of-manager/{employeeId}")\npublic Department getAssignedDepartment(@PathVariable Long employeeId) {\n    return departmentService.getAssignedDepartmentByManagerId(employeeId);\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"service-method-approach-1--via-employee",children:"Service Method (Approach 1 \u2013 Via Employee)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"public Department getAssignedDepartmentByManagerId(Long empId) {\n    return employeeRepository.findById(empId)\n        .map(Employee::getManagedDepartment)\n        .orElse(null);\n}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 Pros: Clean and readable."}),"\n",(0,l.jsx)(n.li,{children:"\u26a0\ufe0f Cons: Relies on employee-to-department mapping being populated."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"code",children:"code"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'\u251c\u2500\u2500\u2500java\n\u2502   \u2514\u2500\u2500\u2500com\n\u2502       \u2514\u2500\u2500\u2500codingshuttle\n\u2502           \u2514\u2500\u2500\u2500tutorial\n\u2502               \u2514\u2500\u2500\u2500dataMapping\n\u2502                   \u2514\u2500\u2500\u2500DataMappingTutorial\n\u2502                       \u2502   DataMappingTutorialApplication.java\n\u2502                       \u2502\n\u2502                       \u251c\u2500\u2500\u2500controllers\n\u2502                       \u2502       DepartmentController.java\n\u2502                       \u2502       EmployeeController.java\n\u2502                       \u2502\n\u2502                       \u251c\u2500\u2500\u2500entities\n\u2502                       \u2502       DepartmentEntity.java\n\u2502                       \u2502       EmployeeEntity.java\n\u2502                       \u2502\n\u2502                       \u251c\u2500\u2500\u2500repositories\n\u2502                       \u2502       DepartmentRepository.java\n\u2502                       \u2502       EmployeeRepository.java\n\u2502                       \u2502       \n\u2502                       \u2514\u2500\u2500\u2500services\n\u2502                               DepartmentService.java\n\u2502                               EmployeeService.java\n\u2502\n\u2514\u2500\u2500\u2500resources\n        application.properties\n\n\npackage com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.entities;\n\nimport jakarta.persistence.*;\nimport lombok.*;\n\n@Entity\n@Data\n@AllArgsConstructor\n@NoArgsConstructor\n@Table(name = "departments")\npublic class DepartmentEntity {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(nullable = false)\n    private String title;\n\n    @OneToOne\n    @JoinColumn(name = "department_manager")\n    private EmployeeEntity manager;\n}\n\n\npackage com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.controllers;\n\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.entities.DepartmentEntity;\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.entities.EmployeeEntity;\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.services.DepartmentService;\nimport org.springframework.web.bind.annotation.*;\n\n@RestController\n@RequestMapping(path = "/departments")\npublic class DepartmentController {\n\n    private final DepartmentService departmentService;\n\n    public DepartmentController(DepartmentService departmentService) {\n        this.departmentService = departmentService;\n    }\n\n    @GetMapping("/{departmentId}")\n    public DepartmentEntity getDepartmentById(@PathVariable Long departmentId) {\n        return departmentService.getDepartmentById(departmentId);\n    }\n\n    @PostMapping\n    public DepartmentEntity createNewDepartment(@RequestBody DepartmentEntity departmentEntity) {\n        return departmentService.createNewDepartment(departmentEntity);\n    }\n\n    @PutMapping(path = "/{departmentId}/manager/{employeeId}")\n    public DepartmentEntity assignManagerToDepartment(@PathVariable Long departmentId,\n                                                      @PathVariable Long employeeId) {\n        return departmentService.assignManagerToDepartment(departmentId, employeeId);\n    }\n\n    @GetMapping(path = "/assignedDepartmentOfManager/{employeeId}")\n    public DepartmentEntity getAssignedDepartmentOfManager( @PathVariable Long employeeId) {\n        return departmentService.getAssignedDepartmentOfManager(employeeId);\n    }\n}\n\n\npackage com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.services;\n\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.entities.DepartmentEntity;\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.entities.EmployeeEntity;\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.repositories.DepartmentRepository;\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.repositories.EmployeeRepository;\nimport org.springframework.stereotype.Service;\n\nimport java.util.Optional;\n\n@Service\npublic class DepartmentService {\n\n    private final EmployeeRepository employeeRepository;\n\n    private final DepartmentRepository departmentRepository;\n    public DepartmentService(EmployeeRepository employeeRepository, DepartmentRepository departmentRepository) {\n        this.employeeRepository = employeeRepository;\n        this.departmentRepository = departmentRepository;\n    }\n\n    public DepartmentEntity createNewDepartment(DepartmentEntity departmentEntity) {\n        return departmentRepository.save(departmentEntity);\n    }\n\n    public DepartmentEntity getDepartmentById(Long id) {\n        return departmentRepository.findById(id).orElse(null);\n    }\n\n    public DepartmentEntity assignManagerToDepartment(Long departmentId, Long employeeId) {\n        Optional<DepartmentEntity> departmentEntity = departmentRepository.findById(departmentId);\n        Optional<EmployeeEntity> employeeEntity = employeeRepository.findById(employeeId);\n\n        return departmentEntity.flatMap(department ->\n                employeeEntity.map(employee -> {\n                    department.setManager(employee);\n                    return departmentRepository.save(department);\n                })).orElse(null);\n    }\n\n    public DepartmentEntity getAssignedDepartmentOfManager(Long employeeId) {\n//        Optional<EmployeeEntity> employeeEntity = employeeRepository.findById(employeeId);\n//        return employeeEntity.map(employee-> employee.getManagedDepartment()).orElse(null);\n\n        EmployeeEntity employeeEntity = EmployeeEntity.builder().id(employeeId).build();\n\n        return departmentRepository.findByManager(employeeEntity);\n    }\n}\n\n\n\npackage com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.services;\n\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.entities.DepartmentEntity;\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.entities.EmployeeEntity;\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.repositories.DepartmentRepository;\nimport com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.repositories.EmployeeRepository;\nimport org.springframework.stereotype.Service;\n\nimport java.util.Optional;\n\n@Service\npublic class DepartmentService {\n\n    private final EmployeeRepository employeeRepository;\n\n    private final DepartmentRepository departmentRepository;\n    public DepartmentService(EmployeeRepository employeeRepository, DepartmentRepository departmentRepository) {\n        this.employeeRepository = employeeRepository;\n        this.departmentRepository = departmentRepository;\n    }\n\n    public DepartmentEntity createNewDepartment(DepartmentEntity departmentEntity) {\n        return departmentRepository.save(departmentEntity);\n    }\n\n    public DepartmentEntity getDepartmentById(Long id) {\n        return departmentRepository.findById(id).orElse(null);\n    }\n\n    public DepartmentEntity assignManagerToDepartment(Long departmentId, Long employeeId) {\n        Optional<DepartmentEntity> departmentEntity = departmentRepository.findById(departmentId);\n        Optional<EmployeeEntity> employeeEntity = employeeRepository.findById(employeeId);\n\n        return departmentEntity.flatMap(department ->\n                employeeEntity.map(employee -> {\n                    department.setManager(employee);\n                    return departmentRepository.save(department);\n                })).orElse(null);\n    }\n\n    public DepartmentEntity getAssignedDepartmentOfManager(Long employeeId) {\n//        Optional<EmployeeEntity> employeeEntity = employeeRepository.findById(employeeId);\n//        return employeeEntity.map(employee-> employee.getManagedDepartment()).orElse(null);\n\n        EmployeeEntity employeeEntity = EmployeeEntity.builder().id(employeeId).build();\n\n        return departmentRepository.findByManager(employeeEntity);\n    }\n}\n\n\n\npackage com.codingshuttle.tutorial.dataMapping.DataMappingTutorial.entities;\n\nimport com.fasterxml.jackson.annotation.JsonIgnore;\nimport jakarta.persistence.*;\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\n@Entity\n@Data\n@AllArgsConstructor\n@NoArgsConstructor\n@Builder\n@Table(name = "employees")\npublic class EmployeeEntity {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(nullable = false)\n    private String name;\n\n    @OneToOne(mappedBy = "manager")\n    @JsonIgnore\n    private DepartmentEntity managedDepartment;\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);